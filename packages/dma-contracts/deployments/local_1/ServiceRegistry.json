{"metadata":"{\"defaultCompiler\":{\"version\":\"0.4.21\"},\"sources\":{\"contracts/core/ServiceRegistry.sol\":{\"content\":\"// SPDX-License-Identifier: AGPL-3.0-or-later\\n\\n/// ServiceRegistry.sol\\n\\n// Copyright (C) 2021-2021 Oazo Apps Limited\\n\\n// This program is free software: you can redistribute it and/or modify\\n// it under the terms of the GNU Affero General Public License as published by\\n// the Free Software Foundation, either version 3 of the License, or\\n// (at your option) any later version.\\n//\\n// This program is distributed in the hope that it will be useful,\\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\\n// GNU Affero General Public License for more details.\\n//\\n// You should have received a copy of the GNU Affero General Public License\\n// along with this program.  If not, see <https://www.gnu.org/licenses/>.\\npragma solidity ^0.8.0;\\n\\ncontract ServiceRegistry {\\n  uint256 public constant MAX_DELAY = 30 days;\\n\\n  mapping(bytes32 => uint256) public lastExecuted;\\n  mapping(bytes32 => address) private namedService;\\n  mapping(bytes32 => bool) private invalidHashes;\\n  address public owner;\\n  uint256 public requiredDelay;\\n\\n  modifier validateInput(uint256 len) {\\n    require(msg.data.length == len, \\\"registry/illegal-padding\\\");\\n    _;\\n  }\\n\\n  modifier delayedExecution() {\\n    bytes32 operationHash = keccak256(msg.data);\\n    uint256 reqDelay = requiredDelay;\\n\\n    /* solhint-disable not-rely-on-time */\\n    if (lastExecuted[operationHash] == 0 && reqDelay > 0) {\\n      // not called before, scheduled for execution\\n      lastExecuted[operationHash] = block.timestamp;\\n      emit ChangeScheduled(operationHash, block.timestamp + reqDelay, msg.data);\\n    } else {\\n      require(block.timestamp - reqDelay > lastExecuted[operationHash], \\\"registry/delay-too-small\\\");\\n      emit ChangeApplied(operationHash, block.timestamp, msg.data);\\n      _;\\n      lastExecuted[operationHash] = 0;\\n    }\\n    /* solhint-enable not-rely-on-time */\\n  }\\n\\n  modifier onlyOwner() {\\n    require(msg.sender == owner, \\\"registry/only-owner\\\");\\n    _;\\n  }\\n\\n  constructor(uint256 initialDelay) {\\n    require(initialDelay <= MAX_DELAY, \\\"registry/invalid-delay\\\");\\n    requiredDelay = initialDelay;\\n    owner = msg.sender;\\n  }\\n\\n  function transferOwnership(\\n    address newOwner\\n  ) external onlyOwner validateInput(36) delayedExecution {\\n    owner = newOwner;\\n  }\\n\\n  function changeRequiredDelay(\\n    uint256 newDelay\\n  ) external onlyOwner validateInput(36) delayedExecution {\\n    require(newDelay <= MAX_DELAY, \\\"registry/invalid-delay\\\");\\n    requiredDelay = newDelay;\\n  }\\n\\n  function getServiceNameHash(string memory name) external pure returns (bytes32) {\\n    return keccak256(abi.encodePacked(name));\\n  }\\n\\n  function addNamedService(\\n    bytes32 serviceNameHash,\\n    address serviceAddress\\n  ) external onlyOwner validateInput(68) delayedExecution {\\n    require(invalidHashes[serviceNameHash] == false, \\\"registry/service-name-used-before\\\");\\n    require(namedService[serviceNameHash] == address(0), \\\"registry/service-override\\\");\\n    namedService[serviceNameHash] = serviceAddress;\\n    emit NamedServiceAdded(serviceNameHash, serviceAddress);\\n  }\\n\\n  function removeNamedService(bytes32 serviceNameHash) external onlyOwner validateInput(36) {\\n    require(namedService[serviceNameHash] != address(0), \\\"registry/service-does-not-exist\\\");\\n    namedService[serviceNameHash] = address(0);\\n    invalidHashes[serviceNameHash] = true;\\n    emit NamedServiceRemoved(serviceNameHash);\\n  }\\n\\n  function getRegisteredService(string memory serviceName) external view returns (address) {\\n    return namedService[keccak256(abi.encodePacked(serviceName))];\\n  }\\n\\n  function getServiceAddress(bytes32 serviceNameHash) external view returns (address) {\\n    return namedService[serviceNameHash];\\n  }\\n\\n  function clearScheduledExecution(\\n    bytes32 scheduledExecution\\n  ) external onlyOwner validateInput(36) {\\n    require(lastExecuted[scheduledExecution] > 0, \\\"registry/execution-not-scheduled\\\");\\n    lastExecuted[scheduledExecution] = 0;\\n    emit ChangeCancelled(scheduledExecution);\\n  }\\n\\n  event ChangeScheduled(bytes32 dataHash, uint256 scheduledFor, bytes data);\\n  event ChangeApplied(bytes32 dataHash, uint256 appliedAt, bytes data);\\n  event ChangeCancelled(bytes32 dataHash);\\n  event NamedServiceRemoved(bytes32 nameHash);\\n  event NamedServiceAdded(bytes32 nameHash, address service);\\n}\\n\",\"versionPragma\":\"^0.8.0\"}}}","address":"0xc6a15814fEFaf471301163AE0a65cDaC48BB2D4d","bytecode":"0x608060405234801561001057600080fd5b50604051610da1380380610da183398101604081905261002f916100a0565b62278d008111156100865760405162461bcd60e51b815260206004820152601660248201527f72656769737472792f696e76616c69642d64656c617900000000000000000000604482015260640160405180910390fd5b600455600380546001600160a01b031916331790556100b9565b6000602082840312156100b257600080fd5b5051919050565b610cd9806100c86000396000f3fe608060405234801561001057600080fd5b50600436106100a45760003560e01c80630851f3bd146100a95780630a5fe881146100d95780634125ff90146100ee5780634a56b027146101065780635b51406f1461011957806368e68f631461012c5780638da5cb5b1461014c578063aaae81b61461015f578063ad11480414610172578063c2527b321461017b578063ea903756146101a4578063f2fde38b146101b7575b600080fd5b6100bc6100b73660046109e1565b6101ca565b6040516001600160a01b0390911681526020015b60405180910390f35b6100ec6100e7366004610a91565b610216565b005b6100f862278d0081565b6040519081526020016100d0565b6100f86101143660046109e1565b6103c7565b6100ec610127366004610ac6565b6103f7565b6100f861013a366004610a91565b60006020819052908152604090205481565b6003546100bc906001600160a01b031681565b6100ec61016d366004610a91565b61067b565b6100f860045481565b6100bc610189366004610a91565b6000908152600160205260409020546001600160a01b031690565b6100ec6101b2366004610a91565b610792565b6100ec6101c5366004610af2565b610878565b600060016000836040516020016101e19190610b14565b60408051601f19818403018152918152815160209283012083529082019290925201600020546001600160a01b031692915050565b6003546001600160a01b031633146102495760405162461bcd60e51b815260040161024090610b43565b60405180910390fd5b602436811461026a5760405162461bcd60e51b815260040161024090610b70565b6000803660405161027c929190610ba2565b60408051918290039091206004546000828152602081905292909220549092501580156102a95750600081115b156102fe5760008281526020819052604090204290819055600080516020610c848339815191529083906102de908490610bc8565b6000366040516102f19493929190610be1565b60405180910390a16103c1565b6000828152602081905260409020546103178242610c1e565b116103345760405162461bcd60e51b815260040161024090610c31565b600080516020610c6483398151915282426000366040516103589493929190610be1565b60405180910390a162278d008411156103ac5760405162461bcd60e51b815260206004820152601660248201527572656769737472792f696e76616c69642d64656c617960501b6044820152606401610240565b60048490556000828152602081905260408120555b50505050565b6000816040516020016103da9190610b14565b604051602081830303815290604052805190602001209050919050565b6003546001600160a01b031633146104215760405162461bcd60e51b815260040161024090610b43565b60443681146104425760405162461bcd60e51b815260040161024090610b70565b60008036604051610454929190610ba2565b60408051918290039091206004546000828152602081905292909220549092501580156104815750600081115b156104d65760008281526020819052604090204290819055600080516020610c848339815191529083906104b6908490610bc8565b6000366040516104c99493929190610be1565b60405180910390a1610674565b6000828152602081905260409020546104ef8242610c1e565b1161050c5760405162461bcd60e51b815260040161024090610c31565b600080516020610c6483398151915282426000366040516105309493929190610be1565b60405180910390a160008581526002602052604090205460ff16156105a15760405162461bcd60e51b815260206004820152602160248201527f72656769737472792f736572766963652d6e616d652d757365642d6265666f726044820152606560f81b6064820152608401610240565b6000858152600160205260409020546001600160a01b0316156106025760405162461bcd60e51b815260206004820152601960248201527872656769737472792f736572766963652d6f7665727269646560381b6044820152606401610240565b60008581526001602090815260409182902080546001600160a01b0319166001600160a01b0388169081179091558251888152918201527f63edbf94cfa8eb1506648e2d92113b771f811bf4cdbf6f7f3a4c8c6078cfe2ab910160405180910390a16000828152602081905260408120555b5050505050565b6003546001600160a01b031633146106a55760405162461bcd60e51b815260040161024090610b43565b60243681146106c65760405162461bcd60e51b815260040161024090610b70565b6000828152600160205260409020546001600160a01b031661072a5760405162461bcd60e51b815260206004820152601f60248201527f72656769737472792f736572766963652d646f65732d6e6f742d6578697374006044820152606401610240565b600082815260016020818152604080842080546001600160a01b03191690556002825292839020805460ff191690921790915590518381527f43817158e31105419419d3e1024deed95f59ba49876e9891bcb00df762054cf491015b60405180910390a15050565b6003546001600160a01b031633146107bc5760405162461bcd60e51b815260040161024090610b43565b60243681146107dd5760405162461bcd60e51b815260040161024090610b70565b6000828152602081905260409020546108385760405162461bcd60e51b815260206004820181905260248201527f72656769737472792f657865637574696f6e2d6e6f742d7363686564756c65646044820152606401610240565b6000828152602081815260408083209290925590518381527fef2393afd41f32c607a123de95d703349edd33ea1d86af21535ea8040ec7d9849101610786565b6003546001600160a01b031633146108a25760405162461bcd60e51b815260040161024090610b43565b60243681146108c35760405162461bcd60e51b815260040161024090610b70565b600080366040516108d5929190610ba2565b60408051918290039091206004546000828152602081905292909220549092501580156109025750600081115b156109375760008281526020819052604090204290819055600080516020610c848339815191529083906102de908490610bc8565b6000828152602081905260409020546109508242610c1e565b1161096d5760405162461bcd60e51b815260040161024090610c31565b600080516020610c6483398151915282426000366040516109919493929190610be1565b60405180910390a1600380546001600160a01b0386166001600160a01b031990911617905560008281526020819052604081205550505050565b634e487b7160e01b600052604160045260246000fd5b6000602082840312156109f357600080fd5b81356001600160401b0380821115610a0a57600080fd5b818401915084601f830112610a1e57600080fd5b813581811115610a3057610a306109cb565b604051601f8201601f19908116603f01168101908382118183101715610a5857610a586109cb565b81604052828152876020848701011115610a7157600080fd5b826020860160208301376000928101602001929092525095945050505050565b600060208284031215610aa357600080fd5b5035919050565b80356001600160a01b0381168114610ac157600080fd5b919050565b60008060408385031215610ad957600080fd5b82359150610ae960208401610aaa565b90509250929050565b600060208284031215610b0457600080fd5b610b0d82610aaa565b9392505050565b6000825160005b81811015610b355760208186018101518583015201610b1b565b506000920191825250919050565b6020808252601390820152723932b3b4b9ba393c97b7b7363c96b7bbb732b960691b604082015260600190565b60208082526018908201527772656769737472792f696c6c6567616c2d70616464696e6760401b604082015260600190565b8183823760009101908152919050565b634e487b7160e01b600052601160045260246000fd5b80820180821115610bdb57610bdb610bb2565b92915050565b84815283602082015260606040820152816060820152818360808301376000818301608090810191909152601f909201601f191601019392505050565b81810381811115610bdb57610bdb610bb2565b6020808252601890820152771c9959da5cdd1c9e4bd9195b185e4b5d1bdbcb5cdb585b1b60421b60408201526060019056fe06f84d2b0960d69db49055d196f2a6420c16bc37a9818aad2672f4c645968c39f1415364471da738ead8058b0ce88208763abbb3e49efd60a4ba60b70147601aa2646970667358221220b2311199e71523f71d94f41d87acbeb1856bd4d0f9bcf11b7faa924b50d0a17c64736f6c63430008120033","deployedBytecode":"0x608060405234801561001057600080fd5b50600436106100a45760003560e01c80630851f3bd146100a95780630a5fe881146100d95780634125ff90146100ee5780634a56b027146101065780635b51406f1461011957806368e68f631461012c5780638da5cb5b1461014c578063aaae81b61461015f578063ad11480414610172578063c2527b321461017b578063ea903756146101a4578063f2fde38b146101b7575b600080fd5b6100bc6100b73660046109e1565b6101ca565b6040516001600160a01b0390911681526020015b60405180910390f35b6100ec6100e7366004610a91565b610216565b005b6100f862278d0081565b6040519081526020016100d0565b6100f86101143660046109e1565b6103c7565b6100ec610127366004610ac6565b6103f7565b6100f861013a366004610a91565b60006020819052908152604090205481565b6003546100bc906001600160a01b031681565b6100ec61016d366004610a91565b61067b565b6100f860045481565b6100bc610189366004610a91565b6000908152600160205260409020546001600160a01b031690565b6100ec6101b2366004610a91565b610792565b6100ec6101c5366004610af2565b610878565b600060016000836040516020016101e19190610b14565b60408051601f19818403018152918152815160209283012083529082019290925201600020546001600160a01b031692915050565b6003546001600160a01b031633146102495760405162461bcd60e51b815260040161024090610b43565b60405180910390fd5b602436811461026a5760405162461bcd60e51b815260040161024090610b70565b6000803660405161027c929190610ba2565b60408051918290039091206004546000828152602081905292909220549092501580156102a95750600081115b156102fe5760008281526020819052604090204290819055600080516020610c848339815191529083906102de908490610bc8565b6000366040516102f19493929190610be1565b60405180910390a16103c1565b6000828152602081905260409020546103178242610c1e565b116103345760405162461bcd60e51b815260040161024090610c31565b600080516020610c6483398151915282426000366040516103589493929190610be1565b60405180910390a162278d008411156103ac5760405162461bcd60e51b815260206004820152601660248201527572656769737472792f696e76616c69642d64656c617960501b6044820152606401610240565b60048490556000828152602081905260408120555b50505050565b6000816040516020016103da9190610b14565b604051602081830303815290604052805190602001209050919050565b6003546001600160a01b031633146104215760405162461bcd60e51b815260040161024090610b43565b60443681146104425760405162461bcd60e51b815260040161024090610b70565b60008036604051610454929190610ba2565b60408051918290039091206004546000828152602081905292909220549092501580156104815750600081115b156104d65760008281526020819052604090204290819055600080516020610c848339815191529083906104b6908490610bc8565b6000366040516104c99493929190610be1565b60405180910390a1610674565b6000828152602081905260409020546104ef8242610c1e565b1161050c5760405162461bcd60e51b815260040161024090610c31565b600080516020610c6483398151915282426000366040516105309493929190610be1565b60405180910390a160008581526002602052604090205460ff16156105a15760405162461bcd60e51b815260206004820152602160248201527f72656769737472792f736572766963652d6e616d652d757365642d6265666f726044820152606560f81b6064820152608401610240565b6000858152600160205260409020546001600160a01b0316156106025760405162461bcd60e51b815260206004820152601960248201527872656769737472792f736572766963652d6f7665727269646560381b6044820152606401610240565b60008581526001602090815260409182902080546001600160a01b0319166001600160a01b0388169081179091558251888152918201527f63edbf94cfa8eb1506648e2d92113b771f811bf4cdbf6f7f3a4c8c6078cfe2ab910160405180910390a16000828152602081905260408120555b5050505050565b6003546001600160a01b031633146106a55760405162461bcd60e51b815260040161024090610b43565b60243681146106c65760405162461bcd60e51b815260040161024090610b70565b6000828152600160205260409020546001600160a01b031661072a5760405162461bcd60e51b815260206004820152601f60248201527f72656769737472792f736572766963652d646f65732d6e6f742d6578697374006044820152606401610240565b600082815260016020818152604080842080546001600160a01b03191690556002825292839020805460ff191690921790915590518381527f43817158e31105419419d3e1024deed95f59ba49876e9891bcb00df762054cf491015b60405180910390a15050565b6003546001600160a01b031633146107bc5760405162461bcd60e51b815260040161024090610b43565b60243681146107dd5760405162461bcd60e51b815260040161024090610b70565b6000828152602081905260409020546108385760405162461bcd60e51b815260206004820181905260248201527f72656769737472792f657865637574696f6e2d6e6f742d7363686564756c65646044820152606401610240565b6000828152602081815260408083209290925590518381527fef2393afd41f32c607a123de95d703349edd33ea1d86af21535ea8040ec7d9849101610786565b6003546001600160a01b031633146108a25760405162461bcd60e51b815260040161024090610b43565b60243681146108c35760405162461bcd60e51b815260040161024090610b70565b600080366040516108d5929190610ba2565b60408051918290039091206004546000828152602081905292909220549092501580156109025750600081115b156109375760008281526020819052604090204290819055600080516020610c848339815191529083906102de908490610bc8565b6000828152602081905260409020546109508242610c1e565b1161096d5760405162461bcd60e51b815260040161024090610c31565b600080516020610c6483398151915282426000366040516109919493929190610be1565b60405180910390a1600380546001600160a01b0386166001600160a01b031990911617905560008281526020819052604081205550505050565b634e487b7160e01b600052604160045260246000fd5b6000602082840312156109f357600080fd5b81356001600160401b0380821115610a0a57600080fd5b818401915084601f830112610a1e57600080fd5b813581811115610a3057610a306109cb565b604051601f8201601f19908116603f01168101908382118183101715610a5857610a586109cb565b81604052828152876020848701011115610a7157600080fd5b826020860160208301376000928101602001929092525095945050505050565b600060208284031215610aa357600080fd5b5035919050565b80356001600160a01b0381168114610ac157600080fd5b919050565b60008060408385031215610ad957600080fd5b82359150610ae960208401610aaa565b90509250929050565b600060208284031215610b0457600080fd5b610b0d82610aaa565b9392505050565b6000825160005b81811015610b355760208186018101518583015201610b1b565b506000920191825250919050565b6020808252601390820152723932b3b4b9ba393c97b7b7363c96b7bbb732b960691b604082015260600190565b60208082526018908201527772656769737472792f696c6c6567616c2d70616464696e6760401b604082015260600190565b8183823760009101908152919050565b634e487b7160e01b600052601160045260246000fd5b80820180821115610bdb57610bdb610bb2565b92915050565b84815283602082015260606040820152816060820152818360808301376000818301608090810191909152601f909201601f191601019392505050565b81810381811115610bdb57610bdb610bb2565b6020808252601890820152771c9959da5cdd1c9e4bd9195b185e4b5d1bdbcb5cdb585b1b60421b60408201526060019056fe06f84d2b0960d69db49055d196f2a6420c16bc37a9818aad2672f4c645968c39f1415364471da738ead8058b0ce88208763abbb3e49efd60a4ba60b70147601aa2646970667358221220b2311199e71523f71d94f41d87acbeb1856bd4d0f9bcf11b7faa924b50d0a17c64736f6c63430008120033","abi":[{"inputs":[{"internalType":"uint256","name":"initialDelay","type":"uint256"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"bytes32","name":"dataHash","type":"bytes32"},{"indexed":false,"internalType":"uint256","name":"appliedAt","type":"uint256"},{"indexed":false,"internalType":"bytes","name":"data","type":"bytes"}],"name":"ChangeApplied","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"bytes32","name":"dataHash","type":"bytes32"}],"name":"ChangeCancelled","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"bytes32","name":"dataHash","type":"bytes32"},{"indexed":false,"internalType":"uint256","name":"scheduledFor","type":"uint256"},{"indexed":false,"internalType":"bytes","name":"data","type":"bytes"}],"name":"ChangeScheduled","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"bytes32","name":"nameHash","type":"bytes32"},{"indexed":false,"internalType":"address","name":"service","type":"address"}],"name":"NamedServiceAdded","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"bytes32","name":"nameHash","type":"bytes32"}],"name":"NamedServiceRemoved","type":"event"},{"inputs":[],"name":"MAX_DELAY","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"serviceNameHash","type":"bytes32"},{"internalType":"address","name":"serviceAddress","type":"address"}],"name":"addNamedService","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"newDelay","type":"uint256"}],"name":"changeRequiredDelay","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"scheduledExecution","type":"bytes32"}],"name":"clearScheduledExecution","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"serviceName","type":"string"}],"name":"getRegisteredService","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"serviceNameHash","type":"bytes32"}],"name":"getServiceAddress","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"name","type":"string"}],"name":"getServiceNameHash","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"pure","type":"function"},{"inputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"name":"lastExecuted","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"serviceNameHash","type":"bytes32"}],"name":"removeNamedService","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"requiredDelay","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"}]}